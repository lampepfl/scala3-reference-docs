<html><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><title>Safe Initialization</title><link rel="shortcut icon" type="image/x-icon" href="../favicon.ico"></link><script type="text/javascript" src="../scripts/theme.js"></script><link rel="stylesheet" href="../css/bootstrap.min.css"></link><link rel="stylesheet" href="../css/dottydoc.css"></link><link rel="stylesheet" href="../css/color-brewer.css"></link><script type="text/javascript" src="../js/jquery.min.js" defer="true"></script><script type="text/javascript" src="../js/bootstrap.min.js" defer="true"></script><link rel="stylesheet" href="../css/content-contributors.css"></link><script type="text/javascript" src="../js/contributors.js" defer="true"></script><script type="text/javascript" src="../scripts/searchData.js" defer="true"></script><script type="text/javascript" src="../scripts/scastieConfiguration.js" defer="true"></script><link rel="stylesheet" href="../styles/nord-light.css"></link><link rel="stylesheet" href="../styles/scalastyle.css"></link><link rel="stylesheet" href="../styles/colors.css"></link><link rel="stylesheet" href="../styles/dotty-icons.css"></link><link rel="stylesheet" href="../styles/diagram.css"></link><link rel="stylesheet" href="../styles/filter-bar.css"></link><link rel="stylesheet" href="../styles/code-snippets.css"></link><link rel="stylesheet" href="../styles/searchbar.css"></link><link rel="stylesheet" href="../styles/social-links.css"></link><link rel="stylesheet" href="../styles/ux.css"></link><link rel="stylesheet" href="../styles/versions-dropdown.css"></link><link rel="stylesheet" href="../styles/fontawesome.css"></link><script type="text/javascript" src="../hljs/highlight.min.js" defer="true"></script><script type="text/javascript" src="../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../scripts/scaladoc-scalajs.js" defer="true"></script><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><script type="text/javascript" src="https://scastie.scala-lang.org/embedded.js" defer="true"></script><script type="text/javascript" src="../scripts/data.js" defer="true"></script><script>var pathToRoot = "../";</script><script>var githubContributorsUrl = "https://api.github.com/repos/lampepfl/dotty";</script><script>var githubContributorsFilename = "docs/_docs/reference/other-new-features/safe-initialization.md";</script></head><body><div id="container"><div id="leftColumn"><div id="logo"><span><img src="../project-logo/logo.svg"></img></span><span><div class="projectName">Scala 3 Reference</div></span><div id="version"><div class="versions-dropdown"><div onclick="dropdownHandler()" id="dropdown-button" class="dropdownbtn dropdownbtnactive"><div class="projectVersion">3.1.2</div><div id="dropdown-content" class="dropdown-content"><input type="text" placeholder="Search..." id="dropdown-input" onkeyup="filterFunction()"></input></div></div></div></div><div class="socials"><a href="https://github.com/lampepfl/dotty"><span class="social-icon" data-icon-path="github-icon-white.png"></span></a><a href="https://discord.com/invite/scala"><span class="social-icon" data-icon-path="discord-icon-white.png"></span></a><a href="https://twitter.com/scala_lang"><span class="social-icon" data-icon-path="twitter-icon-white.png"></span></a></div></div><div id="paneSearch"></div><nav id="sideMenu2"><div class="ni expanded"><span class="nh expanded"><span class="ar"></span><a href="../index.html"><span>Scala 3 Reference</span></a></span><div class="ni"><span class="nh "><span class="ar"></span><a href="../new-types/index.html"><span>New Types</span></a></span><div class="ni "><span class="nh "><a href="../new-types/intersection-types.html"><span>Intersection Types</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/union-types.html"><span>Union Types</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/type-lambdas.html"><span>Type Lambdas</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/match-types.html"><span>Match Types</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/dependent-function-types.html"><span>Dependent Function Types</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/polymorphic-function-types.html"><span>Polymorphic Function Types</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../enums/index.html"><span>Enums</span></a></span><div class="ni "><span class="nh "><a href="../enums/enums.html"><span>Enumerations</span></a></span></div><div class="ni "><span class="nh "><a href="../enums/adts.html"><span>Algebraic Data Types</span></a></span></div><div class="ni "><span class="nh "><a href="../enums/desugarEnums.html"><span>Translation of Enums and ADTs</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../contextual/index.html"><span>Contextual Abstractions</span></a></span><div class="ni "><span class="nh "><a href="../contextual/givens.html"><span>Given Instances</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/using-clauses.html"><span>Using Clauses</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/context-bounds.html"><span>Context Bounds</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/given-imports.html"><span>Importing Givens</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/extension-methods.html"><span>Extension Methods</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/right-associative-extension-methods.html"><span>Right-Associative Extension Methods: Details</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/type-classes.html"><span>Implementing Type classes</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/derivation.html"><span>Type Class Derivation</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/derivation-macro.html"><span>How to write a type class `derived` method using macros</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/multiversal-equality.html"><span>Multiversal Equality</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/context-functions.html"><span>Context Functions</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/conversions.html"><span>Implicit Conversions</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/by-name-context-parameters.html"><span>By-Name Context Parameters</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/relationship-implicits.html"><span>Relationship with Scala 2 Implicits</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../metaprogramming/index.html"><span>Metaprogramming</span></a></span><div class="ni "><span class="nh "><a href="../metaprogramming/inline.html"><span>Inline</span></a></span></div><div class="ni "><span class="nh "><a href="../metaprogramming/compiletime-ops.html"><span>Compile-time operations</span></a></span></div><div class="ni "><span class="nh "><a href="../metaprogramming/macros.html"><span>Macros</span></a></span></div><div class="ni "><span class="nh "><a href="../metaprogramming/staging.html"><span>Runtime Multi-Stage Programming</span></a></span></div><div class="ni "><span class="nh "><a href="../metaprogramming/reflection.html"><span>Reflection</span></a></span></div><div class="ni "><span class="nh "><a href="../metaprogramming/tasty-inspect.html"><span>TASTy Inspection</span></a></span></div><div class="ni "><span class="nh "><a href="../metaprogramming/simple-smp.html"><span>The Meta-theory of Symmetric Metaprogramming</span></a></span></div></div><div class="ni expanded"><span class="nh expanded"><span class="ar"></span><a href="index.html"><span>Other New Features</span></a></span><div class="ni "><span class="nh "><a href="trait-parameters.html"><span>Trait Parameters</span></a></span></div><div class="ni "><span class="nh "><a href="transparent-traits.html"><span>Transparent Traits</span></a></span></div><div class="ni "><span class="nh "><a href="creator-applications.html"><span>Universal Apply Methods</span></a></span></div><div class="ni "><span class="nh "><a href="export.html"><span>Export Clauses</span></a></span></div><div class="ni "><span class="nh "><a href="opaques.html"><span>Opaque Type Aliases</span></a></span></div><div class="ni "><span class="nh "><a href="opaques-details.html"><span>Opaque Type Aliases: More Details</span></a></span></div><div class="ni "><span class="nh "><a href="open-classes.html"><span>Open Classes</span></a></span></div><div class="ni "><span class="nh "><a href="parameter-untupling.html"><span>Parameter Untupling</span></a></span></div><div class="ni "><span class="nh "><a href="kind-polymorphism.html"><span>Kind Polymorphism</span></a></span></div><div class="ni "><span class="nh "><a href="matchable.html"><span>The Matchable Trait</span></a></span></div><div class="ni "><span class="nh "><a href="threadUnsafe-annotation.html"><span>The @threadUnsafe annotation</span></a></span></div><div class="ni "><span class="nh "><a href="targetName.html"><span>The @targetName annotation</span></a></span></div><div class="ni "><span class="nh "><a href="control-syntax.html"><span>New Control Syntax</span></a></span></div><div class="ni "><span class="nh "><a href="indentation.html"><span>Optional Braces</span></a></span></div><div class="ni expanded"><span class="nh selected"><a href="safe-initialization.html"><span>Safe Initialization</span></a></span></div><div class="ni "><span class="nh "><a href="type-test.html"><span>TypeTest</span></a></span></div><div class="ni "><span class="nh "><a href="experimental-defs.html"><span>Experimental Definitions</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../changed-features/index.html"><span>Other Changed Features</span></a></span><div class="ni "><span class="nh "><a href="../changed-features/numeric-literals.html"><span>Numeric Literals</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/structural-types.html"><span>Programmatic Structural Types</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/operators.html"><span>Rules for Operators</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/wildcards.html"><span>Wildcard Arguments in Types</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/imports.html"><span>Imports</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/type-checking.html"><span>Changes in Type Checking</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/type-inference.html"><span>Changes in Type Inference</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/implicit-resolution.html"><span>Changes in Implicit Resolution</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/implicit-conversions.html"><span>Implicit Conversions</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/overload-resolution.html"><span>Changes in Overload Resolution</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/match-syntax.html"><span>Match Expressions</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/vararg-splices.html"><span>Vararg Splices</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/pattern-bindings.html"><span>Pattern Bindings</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/pattern-matching.html"><span>Option-less pattern matching</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/eta-expansion.html"><span>Automatic Eta Expansion</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/compiler-plugins.html"><span>Changes in Compiler Plugins</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/lazy-vals-init.html"><span>Lazy Vals Initialization</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/main-functions.html"><span>Main Methods</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/interpolation-escapes.html"><span>Escapes in interpolations</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../dropped-features/index.html"><span>Dropped Features</span></a></span><div class="ni "><span class="nh "><a href="../dropped-features/delayed-init.html"><span>Dropped: DelayedInit</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/macros.html"><span>Dropped: Scala 2 Macros</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/existential-types.html"><span>Dropped: Existential Types</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/type-projection.html"><span>Dropped: General Type Projection</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/do-while.html"><span>Dropped: Do-While</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/procedure-syntax.html"><span>Dropped: Procedure Syntax</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/package-objects.html"><span>Dropped: Package Objects</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/early-initializers.html"><span>Dropped: Early Initializers</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/class-shadowing.html"><span>Dropped: Class Shadowing</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/limit22.html"><span>Dropped: Limit 22</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/xml.html"><span>Dropped: XML Literals</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/symlits.html"><span>Dropped: Symbol Literals</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/auto-apply.html"><span>Dropped: Auto-Application</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/weak-conformance.html"><span>Dropped: Weak Conformance</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/nonlocal-returns.html"><span>Deprecated: Nonlocal Returns</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/this-qualifier.html"><span>Dropped: private[this] and protected[this]</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/wildcard-init.html"><span>Dropped: Wildcard Initializer</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../experimental/index.html"><span>Experimental</span></a></span><div class="ni "><span class="nh "><a href="../experimental/fewer-braces.html"><span>Fewer Braces</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/canthrow.html"><span>CanThrow Capabilities</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/erased-defs.html"><span>Erased Definitions</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/named-typeargs.html"><span>Named Type Arguments</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/numeric-literals.html"><span>Numeric Literals</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/explicit-nulls.html"><span>Explicit Nulls</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/main-annotation.html"><span>MainAnnotation</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/cc.html"><span>Capture Checking</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/tupled-function.html"><span>Tupled Function</span></a></span></div></div><div class="ni "><span class="nh "><a href="../syntax.html"><span>Scala 3 Syntax Summary</span></a></span></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../language-versions/index.html"><span>Language Versions</span></a></span><div class="ni "><span class="nh "><a href="../language-versions/source-compatibility.html"><span>Source Compatibility</span></a></span></div><div class="ni "><span class="nh "><a href="../language-versions/binary-compatibility.html"><span>Binary Compatibility</span></a></span></div></div><div class="ni "><span class="nh "><a href="../soft-modifier.html"><span>Soft Keywords</span></a></span></div><div class="ni "><span class="nh "><a href="../features-classification.html"><span>A Classification of Proposed Language Features</span></a></span></div></div></nav></div><div id="main"><div id="leftToggler"><span class="icon-toggler"></span></div><div id="scaladoc-searchBar"></div><main id="main-content"><div class="breadcrumbs container"><a href="../index.html">Scala 3 Reference</a>/<a href="index.html">Other New Features</a>/<a href="safe-initialization.html">Safe Initialization</a></div><div id="content"><html>
 <head>
  <link rel="dns-prefetch" href="//fonts.googleapis.com"> 
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"> 
 </head>
 <body>
  <div id="content-wrapper"> 
   <div class="container"> 
    <div id="site-header"> 
     <div class="wrap"> 
      <nav class="navigation" role="menu"> 
       <ul class="navigation-menu"> 
        <li class="navigation-menu-item"> <a href="https://docs.scala-lang.org/" class="active">Learn</a> </li> 
        <li class="navigation-menu-item"> <a href="https://www.scala-lang.org/download/">Install</a> </li> 
        <li class="navigation-menu-item"> <a href="https://scastie.scala-lang.org">Playground</a> </li> 
        <li class="navigation-menu-item"> <a href="https://index.scala-lang.org">Find A Library</a> </li> 
        <li class="navigation-menu-item"> <a href="https://www.scala-lang.org/community/">Community</a> </li> 
        <li class="navigation-menu-item"> <a href="https://www.scala-lang.org/blog/">Blog</a> </li> 
       </ul> 
      </nav> 
     </div> 
    </div> 
    <main> 
     <header> 
      <h1>Safe Initialization</h1> 
      <div class="byline"> <a href="https://github.com/lampepfl/dotty/edit/d7c3fa42e25011cb4cca94ae14705d6eb125ff9e/docs/_docs/reference/other-new-features/safe-initialization.md"> <i class="far fa-edit"></i> Edit this page on GitHub </a> 
      </div> 
     </header> 
     <p>Scala 3 implements experimental safe initialization check, which can be enabled by the compiler option <code>-Ysafe-init</code>.</p> 
     <section id="a-quick-glance"> 
      <h2><a href="#a-quick-glance" class="anchor"></a>A Quick Glance</h2> 
      <p>To get a feel of how it works, we first show several examples below.</p> 
     </section>
     <section id="parent-child-interaction"> 
      <h3><a href="#parent-child-interaction" class="anchor"></a>Parent-Child Interaction</h3> 
      <p>Given the following code snippet:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>abstract class AbstractFile:
</span><span id="1" class=""><span class="tooltip-container"></span>  def name: String
</span><span id="2" class=""><span class="tooltip-container"></span>  val extension: String = name.substring(4)
</span><span id="3" class=""><span class="tooltip-container"></span>
</span><span id="4" class=""><span class="tooltip-container"></span>class RemoteFile(url: String) extends AbstractFile:
</span><span id="5" class=""><span class="tooltip-container"></span>  val localFile: String = s"${url.##}.tmp"  // error: usage of `localFile` before it's initialized
</span><span id="6" class=""><span class="tooltip-container"></span>  def name: String = localFile
</span></code></pre>
      </div> 
      <p>The checker will report:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>-- Warning: tests/init/neg/AbstractFile.scala:7:4 ------------------------------
</span><span id="1" class=""><span class="tooltip-container"></span>7 |	val localFile: String = s"${url.##}.tmp"  // error: usage of `localFile` before it's initialized
</span><span id="2" class=""><span class="tooltip-container"></span>  |	    ^
</span><span id="3" class=""><span class="tooltip-container"></span>  |    Access non-initialized field value localFile. Calling trace:
</span><span id="4" class=""><span class="tooltip-container"></span>  |     -&gt; val extension: String = name.substring(4)	[ AbstractFile.scala:3 ]
</span><span id="5" class=""><span class="tooltip-container"></span>  |      -&gt; def name: String = localFile            	[ AbstractFile.scala:8 ]
</span></code></pre>
      </div>
     </section>
     <section id="inner-outer-interaction"> 
      <h3><a href="#inner-outer-interaction" class="anchor"></a>Inner-Outer Interaction</h3> 
      <p>Given the code below:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>object Trees:
</span><span id="1" class=""><span class="tooltip-container"></span>  class ValDef { counter += 1 }
</span><span id="2" class=""><span class="tooltip-container"></span>  class EmptyValDef extends ValDef
</span><span id="3" class=""><span class="tooltip-container"></span>  val theEmptyValDef = new EmptyValDef
</span><span id="4" class=""><span class="tooltip-container"></span>  private var counter = 0  // error
</span></code></pre>
      </div> 
      <p>The checker will report:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>-- Warning: tests/init/neg/trees.scala:5:14 ------------------------------------
</span><span id="1" class=""><span class="tooltip-container"></span>5 |  private var counter = 0  // error
</span><span id="2" class=""><span class="tooltip-container"></span>  |              ^
</span><span id="3" class=""><span class="tooltip-container"></span>  |             Access non-initialized field variable counter. Calling trace:
</span><span id="4" class=""><span class="tooltip-container"></span>  |              -&gt; val theEmptyValDef = new EmptyValDef    [ trees.scala:4 ]
</span><span id="5" class=""><span class="tooltip-container"></span>  |               -&gt; class EmptyValDef extends ValDef       [ trees.scala:3 ]
</span><span id="6" class=""><span class="tooltip-container"></span>  |                -&gt; class ValDef { counter += 1 }	     [ trees.scala:2 ]
</span></code></pre>
      </div>
     </section>
     <section id="functions"> 
      <h3><a href="#functions" class="anchor"></a>Functions</h3> 
      <p>Given the code below:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>abstract class Parent:
</span><span id="1" class=""><span class="tooltip-container"></span>  val f: () =&gt; String = () =&gt; this.message
</span><span id="2" class=""><span class="tooltip-container"></span>  def message: String
</span><span id="3" class=""><span class="tooltip-container"></span>
</span><span id="4" class=""><span class="tooltip-container"></span>class Child extends Parent:
</span><span id="5" class=""><span class="tooltip-container"></span>  val a = f()
</span><span id="6" class=""><span class="tooltip-container"></span>  val b = "hello"           // error
</span><span id="7" class=""><span class="tooltip-container"></span>  def message: String = b
</span></code></pre>
      </div> 
      <p>The checker reports:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>-- Warning: tests/init/neg/features-high-order.scala:7:6 -----------------------
</span><span id="1" class=""><span class="tooltip-container"></span>7 |  val b = "hello"           // error
</span><span id="2" class=""><span class="tooltip-container"></span>  |      ^
</span><span id="3" class=""><span class="tooltip-container"></span>  |Access non-initialized field value b. Calling trace:
</span><span id="4" class=""><span class="tooltip-container"></span>  | -&gt; val a = f()                              	[ features-high-order.scala:6 ]
</span><span id="5" class=""><span class="tooltip-container"></span>  |   -&gt; val f: () =&gt; String = () =&gt; this.message	[ features-high-order.scala:2 ]
</span><span id="6" class=""><span class="tooltip-container"></span>  |    -&gt; def message: String = b	                [ features-high-order.scala:8 ]
</span></code></pre>
      </div>
     </section>
     <section id="design-goals"> 
      <h2><a href="#design-goals" class="anchor"></a>Design Goals</h2> 
      <p>We establish the following design goals:</p> 
      <ul> 
       <li><strong>Sound</strong>: checking always terminates, and is sound for common and reasonable usage (over-approximation)</li> 
       <li><strong>Expressive</strong>: support common and reasonable initialization patterns</li> 
       <li><strong>Friendly</strong>: simple rules, minimal syntactic overhead, informative error messages</li> 
       <li><strong>Modular</strong>: modular checking, no analysis beyond project boundary</li> 
       <li><strong>Fast</strong>: instant feedback</li> 
       <li><strong>Simple</strong>: no changes to core type system, explainable by a simple theory</li> 
      </ul> 
      <p>By <em>reasonable usage</em>, we include the following use cases (but not restricted to them):</p> 
      <ul> 
       <li>Access fields on <code>this</code> and outer <code>this</code> during initialization</li> 
       <li>Call methods on <code>this</code> and outer <code>this</code> during initialization</li> 
       <li>Instantiate inner class and call methods on such instances during initialization</li> 
       <li>Capture fields in functions</li> 
      </ul> 
     </section>
     <section id="principles"> 
      <h2><a href="#principles" class="anchor"></a>Principles</h2> 
      <p>To achieve the goals, we uphold three fundamental principles: <em>stackability</em>, <em>monotonicity</em> and <em>scopability</em>.</p> 
      <p>Stackability means that all fields of a class are initialized at the end of the class body. Scala enforces this property in syntax by demanding that all fields are initialized at the end of the primary constructor, except for the language feature below:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>var x: T = _
</span></code></pre>
      </div> 
      <p>Control effects such as exceptions may break this property, as the following example shows:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>class MyException(val b: B) extends Exception("")
</span><span id="1" class=""><span class="tooltip-container"></span>class A:
</span><span id="2" class=""><span class="tooltip-container"></span>  val b = try { new B } catch { case myEx: MyException =&gt; myEx.b }
</span><span id="3" class=""><span class="tooltip-container"></span>  println(b.a)
</span><span id="4" class=""><span class="tooltip-container"></span>
</span><span id="5" class=""><span class="tooltip-container"></span>class B:
</span><span id="6" class=""><span class="tooltip-container"></span>  throw new MyException(this)
</span><span id="7" class=""><span class="tooltip-container"></span>  val a: Int = 1
</span></code></pre>
      </div> 
      <p>In the code above, the control effect teleport the uninitialized value wrapped in an exception. In the implementation, we avoid the problem by ensuring that the values that are thrown must be transitively initialized.</p> 
      <p>Monotonicity means that the initialization status of an object should not go backward: initialized fields continue to be initialized, a field points to an initialized object may not later point to an object under initialization. As an example, the following code will be rejected:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>trait Reporter:
</span><span id="1" class=""><span class="tooltip-container"></span>  def report(msg: String): Unit
</span><span id="2" class=""><span class="tooltip-container"></span>
</span><span id="3" class=""><span class="tooltip-container"></span>class FileReporter(ctx: Context) extends Reporter:
</span><span id="4" class=""><span class="tooltip-container"></span>  ctx.typer.reporter = this                // ctx now reaches an uninitialized object
</span><span id="5" class=""><span class="tooltip-container"></span>  val file: File = new File("report.txt")
</span><span id="6" class=""><span class="tooltip-container"></span>  def report(msg: String) = file.write(msg)
</span></code></pre>
      </div> 
      <p>In the code above, suppose <code>ctx</code> points to a transitively initialized object. Now the assignment at line 3 makes <code>this</code>, which is not fully initialized, reachable from <code>ctx</code>. This makes field usage dangerous, as it may indirectly reach uninitialized fields.</p> 
      <p>Monotonicity is based on a well-known technique called <em>heap monotonic typestate</em> to ensure soundness in the presence of aliasing [1]. Roughly speaking, it means initialization state should not go backwards.</p> 
      <p>Scopability means that there are no side channels to access to partially constructed objects. Control effects like coroutines, delimited control, resumable exceptions may break the property, as they can transport a value upper in the stack (not in scope) to be reachable from the current scope. Static fields can also serve as a teleport thus breaks this property. In the implementation, we need to enforce that teleported values are transitively initialized.</p> 
      <p>The principles enable <em>local reasoning</em> of initialization, which means:</p> 
      <blockquote> 
       <p>An initialized environment can only produce initialized values.</p> 
      </blockquote> 
      <p>For example, if the arguments to an <code>new</code>-expression are transitively initialized, so is the result. If the receiver and arguments in a method call are transitively initialized, so is the result.</p> 
     </section>
     <section id="rules"> 
      <h2><a href="#rules" class="anchor"></a>Rules</h2> 
      <p>With the established principles and design goals, following rules are imposed:</p> 
      <ol> 
       <li> <p>In an assignment <code>o.x = e</code>, the expression <code>e</code> may only point to transitively initialized objects.</p> <p>This is how monotonicity is enforced in the system. Note that in an initialization <code>val f: T = e</code>, the expression <code>e</code> may point to an object under initialization. This requires a distinction between mutation and initialization in order to enforce different rules. Scala has different syntax for them, it thus is not an issue.</p> </li> 
       <li> <p>Objects under initialization may not be passed as arguments to method calls.</p> <p>Escape of <code>this</code> in the constructor is commonly regarded as an anti-pattern. However, escape of <code>this</code> as constructor arguments are allowed, to support creation of cyclic data structures. The checker will ensure that the escaped non-initialized object is not used, i.e. calling methods or accessing fields on the escaped object is not allowed.</p> </li> 
      </ol> 
     </section>
     <section id="modularity"> 
      <h2><a href="#modularity" class="anchor"></a>Modularity</h2> 
      <p>The analysis takes the primary constructor of concrete classes as entry points. It follows the constructors of super classes, which might be defined in another project. The analysis takes advantage of TASTy for analyzing super classes defined in another project.</p> 
      <p>The crossing of project boundary raises a concern about modularity. It is well-known in object-oriented programming that superclass and subclass are tightly coupled. For example, adding a method in the superclass requires recompiling the child class for checking safe overriding.</p> 
      <p>Initialization is no exception in this respect. The initialization of an object essentially invovles close interaction between subclass and superclass. If the superclass is defined in another project, the crossing of project boundary cannot be avoided for soundness of the analysis.</p> 
      <p>Meanwhile, inheritance across project boundary has been under scrutiny and the introduction of <a href="open-classes.html">open classes</a> mitigate the concern here. For example, the initialization check could enforce that the constructors of open classes may not contain method calls on <code>this</code> or introduce annotations as a contract.</p> 
      <p>The feedback from the community on the topic is welcome.</p> 
     </section>
     <section id="back-doors"> 
      <h2><a href="#back-doors" class="anchor"></a>Back Doors</h2> 
      <p>Occasionally you may want to suppress warnings reported by the checker. You can either write <code>e: @unchecked</code> to tell the checker to skip checking for the expression <code>e</code>, or you may use the old trick: mark some fields as lazy.</p> 
     </section>
     <section id="caveats"> 
      <h2><a href="#caveats" class="anchor"></a>Caveats</h2> 
      <ul> 
       <li>The system cannot provide safety guarantee when extending Java or Scala 2 classes.</li> 
       <li>Safe initialization of global objects is only partially checked.</li> 
      </ul> 
     </section>
     <section id="references"> 
      <h2><a href="#references" class="anchor"></a>References</h2> 
      <ol> 
       <li>Fähndrich, M. and Leino, K.R.M., 2003, July. <a href="https://www.microsoft.com/en-us/research/publication/heap-monotonic-typestate/"><em>Heap monotonic typestates</em></a>. In International Workshop on Aliasing, Confinement and Ownership in object-oriented programming (IWACO).</li> 
       <li>Fengyun Liu, Ondřej Lhoták, Aggelos Biboudis, Paolo G. Giarrusso, and Martin Odersky. 2020. <a href="https://dl.acm.org/doi/10.1145/3428243"><em>A type-and-effect system for object initialization</em></a>. OOPSLA, 2020.</li> 
      </ol> 
     </section> 
    </main> 
    <nav class="arrows-wrapper" aria-label="Page navigation"> <a rel="prev" href="indentation.html" class="arrows previous" aria-keyshortcuts="Left"> <span>Optional Braces</span> <i class="fa fa-angle-left"></i> </a> <a rel="next" href="type-test.html" class="arrows next" aria-keyshortcuts="Right"> <span>TypeTest</span> <i class="fa fa-angle-right"></i> </a> 
    </nav> 
    <div class="content-contributors hidden"> <span><b>Contributors to this page</b></span> 
     <div id="documentation-contributors" class="contributors-container"></div> 
    </div> 
   </div> 
  </div>
 </body>
</html></div></main><footer><div id="generated-by"><span class="footer-text">Generated by</span><a href="https://github.com/lampepfl/dotty/tree/main/scaladoc"><img src="../images/scaladoc_logo.svg" alt="scaladoc" class="scaladoc_logo"></img><img src="../images/scaladoc_logo_dark.svg" alt="scaladoc" class="scaladoc_logo_dark"></img></a></div><span id="footer-text">Copyright (c) 2002-2022, LAMP/EPFL</span><div class="socials"><span class="footer-text">Social links</span><a href="https://github.com/lampepfl/dotty"><span class="social-icon" data-icon-path="github-icon-black.png"></span></a><a href="https://discord.com/invite/scala"><span class="social-icon" data-icon-path="discord-icon-black.png"></span></a><a href="https://twitter.com/scala_lang"><span class="social-icon" data-icon-path="twitter-icon-black.png"></span></a></div><div class="mode"><span class="footer-text">Mode</span><label id="theme-toggle" class="switch"><input type="checkbox"></input><span class="slider"></span></label></div><span class="go-to-top-icon"><a href="#container"><span class="icon-vertical_align_top"></span><span class="footer-text">Back to top</span></a></span></footer></div><div id="toc"><span class="toc-title">In this article</span><nav class="toc-nav"><ul class="toc-list"><li><ul><li><a href="#a-quick-glance">A Quick Glance</a><ul><li><a href="#parent-child-interaction">Parent-Child Interaction</a></li><li><a href="#inner-outer-interaction">Inner-Outer Interaction</a></li><li><a href="#functions">Functions</a></li></ul></li><li><a href="#design-goals">Design Goals</a></li><li><a href="#principles">Principles</a></li><li><a href="#rules">Rules</a></li><li><a href="#modularity">Modularity</a></li><li><a href="#back-doors">Back Doors</a></li><li><a href="#caveats">Caveats</a></li><li><a href="#references">References</a></li></ul></li></ul></nav></div></div></body></html>