<!DOCTYPE html><html data-githubContributorsUrl="https://api.github.com/repos/scala/scala3" data-githubContributorsFilename="docs/_docs/reference/other-new-features/safe-initialization.md" data-pathToRoot="../" data-rawLocation="other-new-features/safe-initialization" data-dynamicSideMenu="false"><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"></meta><title>Safe Initialization</title><link rel="shortcut icon" type="image/x-icon" href="../favicon.ico"></link><script type="text/javascript" src="../scripts/theme.js"></script><script type="text/javascript" src="../scripts/searchData.js" defer="true"></script><script type="text/javascript" src="../scripts/scastieConfiguration.js" defer="true"></script><link rel="stylesheet" href="../styles/theme/bundle.css"></link><link rel="stylesheet" href="../styles/theme/components/bundle.css"></link><link rel="stylesheet" href="../styles/theme/components/button/bundle.css"></link><link rel="stylesheet" href="../styles/theme/layout/bundle.css"></link><link rel="stylesheet" href="../styles/nord-light.css"></link><link rel="stylesheet" href="../styles/dotty-icons.css"></link><link rel="stylesheet" href="../styles/filter-bar.css"></link><link rel="stylesheet" href="../styles/code-snippets.css"></link><link rel="stylesheet" href="../styles/searchbar.css"></link><link rel="stylesheet" href="../styles/social-links.css"></link><link rel="stylesheet" href="../styles/versions-dropdown.css"></link><link rel="stylesheet" href="../styles/content-contributors.css"></link><link rel="stylesheet" href="../styles/fontawesome.css"></link><script type="text/javascript" src="../hljs/highlight.pack.js" defer="true"></script><script type="text/javascript" src="../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../scripts/scaladoc-scalajs.js" defer="true"></script><script type="text/javascript" src="../scripts/contributors.js" defer="true"></script><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><script type="text/javascript" src="https://scastie.scala-lang.org/embedded.js" defer="true"></script><script type="text/javascript" src="../scripts/data.js" defer="true"></script><link rel="stylesheet" href="../styles/staticsitestyles.css"></link><script>var pathToRoot = "../";</script><link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="/css/dottydoc.css"></head><body><div id=""><div id="header" class="body-small"><div class="header-container-left"><a href="../" class="logo-container"><span id="project-logo" class="project-logo"><img src="../project-logo/logo.svg"></img></span><span id="dark-project-logo" class="project-logo"><img src="../project-logo/logo_dark.svg"></img></span><span class="project-name h300">Scala 3 Reference</span></a><span onclick="dropdownHandler(event)" class="text-button with-arrow" id="dropdown-trigger"><a><div class="projectVersion">3.6.4</div></a></span><div id="version-dropdown" class="dropdown-menu"></div></div><div class="header-container-right"><button id="search-toggle" class="icon-button"></button><a href="https://docs.scala-lang.org/" class="text-button">Learn</a><a href="https://www.scala-lang.org/download/" class="text-button">Install</a><a href="https://scastie.scala-lang.org" class="text-button">Playground</a><a href="https://index.scala-lang.org" class="text-button">Find A Library</a><a href="https://www.scala-lang.org/community/" class="text-button">Community</a><a href="https://www.scala-lang.org/blog/" class="text-button">Blog</a><span id="theme-toggle" class="icon-button"></span><span id="mobile-menu-toggle" class="icon-button hamburger"></span></div></div><div id="mobile-menu"><div class="mobile-menu-header body-small"><span class="mobile-menu-logo"><span id="project-logo" class="project-logo"><img src="../project-logo/logo.svg"></img></span><span id="dark-project-logo" class="project-logo"><img src="../project-logo/logo_dark.svg"></img></span><span class="project-name h300">Scala 3 Reference</span></span><button id="mobile-menu-close" class="icon-button close"></button></div><div class="mobile-menu-container body-medium"><input id="mobile-scaladoc-searchbar-input" class="scaladoc-searchbar-input" type="search" placeholder="Find anything"></input><a href="https://docs.scala-lang.org/" class="mobile-menu-item">Learn</a><a href="https://www.scala-lang.org/download/" class="mobile-menu-item">Install</a><a href="https://scastie.scala-lang.org" class="mobile-menu-item">Playground</a><a href="https://index.scala-lang.org" class="mobile-menu-item">Find A Library</a><a href="https://www.scala-lang.org/community/" class="mobile-menu-item">Community</a><a href="https://www.scala-lang.org/blog/" class="mobile-menu-item">Blog</a><span id="mobile-theme-toggle" class="mobile-menu-item mode"></span></div></div><span id="mobile-sidebar-toggle" class="floating-button"></span><div id="leftColumn" class="body-small"><div class="switcher-container"><a id="docs-nav-button" class="switcher h100 selected" href="../index.html">Docs</a></div><nav id="docs-nav" class="side-menu"><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../new-types/index.html"><span>New Types</span></a></span><div class="ni n1 "><span class="nh de"><a href="../new-types/intersection-types.html"><span>Intersection Types</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../new-types/union-types.html"><span>Union Types</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../new-types/type-lambdas.html"><span>Type Lambdas</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../new-types/match-types.html"><span>Match Types</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../new-types/dependent-function-types.html"><span>Dependent Function Types</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../new-types/polymorphic-function-types.html"><span>Polymorphic Function Types</span></a></span></div></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../enums/index.html"><span>Enums</span></a></span><div class="ni n1 "><span class="nh de"><a href="../enums/enums.html"><span>Enumerations</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../enums/adts.html"><span>Algebraic Data Types</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../enums/desugarEnums.html"><span>Translation of Enums and ADTs</span></a></span></div></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../contextual/index.html"><span>Contextual Abstractions</span></a></span><div class="ni n1 "><span class="nh de"><a href="../contextual/givens.html"><span>Given Instances</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/deferred-givens.html"><span>Deferred Givens</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/more-givens.html"><span>Other Forms Of Givens</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/previous-givens.html"><span>Previous Given Syntax</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/using-clauses.html"><span>Using Clauses</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/context-bounds.html"><span>Context Bounds</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/given-imports.html"><span>Importing Givens</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/extension-methods.html"><span>Extension Methods</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/right-associative-extension-methods.html"><span>Right-Associative Extension Methods: Details</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/type-classes.html"><span>Implementing Type classes</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/derivation.html"><span>Type Class Derivation</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/derivation-macro.html"><span>How to write a type class `derived` method using macros</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/multiversal-equality.html"><span>Multiversal Equality</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/context-functions.html"><span>Context Functions</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/conversions.html"><span>Implicit Conversions</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/by-name-context-parameters.html"><span>By-Name Context Parameters</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../contextual/relationship-implicits.html"><span>Relationship with Scala 2 Implicits</span></a></span></div></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../metaprogramming/index.html"><span>Metaprogramming</span></a></span><div class="ni n1 "><span class="nh de"><a href="../metaprogramming/inline.html"><span>Inline</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../metaprogramming/compiletime-ops.html"><span>Compile-time operations</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../metaprogramming/macros.html"><span>Macros</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../metaprogramming/staging.html"><span>Run-Time Multi-Stage Programming</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../metaprogramming/reflection.html"><span>Reflection</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../metaprogramming/tasty-inspect.html"><span>TASTy Inspection</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../metaprogramming/simple-smp.html"><span>The Meta-theory of Symmetric Metaprogramming</span></a></span></div></div><div class="ni n0 expanded"><span class="nh h100 expanded cs de"><button class="ar icon-button expanded"></button><a href="index.html"><span>Other New Features</span></a></span><div class="ni n1 "><span class="nh de"><a href="trait-parameters.html"><span>Trait Parameters</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="transparent-traits.html"><span>Transparent Traits and Classes</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="creator-applications.html"><span>Universal Apply Methods</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="export.html"><span>Export Clauses</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="opaques.html"><span>Opaque Type Aliases</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="opaques-details.html"><span>Opaque Type Aliases: More Details</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="open-classes.html"><span>Open Classes</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="parameter-untupling.html"><span>Parameter Untupling</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="kind-polymorphism.html"><span>Kind Polymorphism</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="matchable.html"><span>The Matchable Trait</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="threadUnsafe-annotation.html"><span>The @threadUnsafe annotation</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="targetName.html"><span>The @targetName annotation</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="control-syntax.html"><span>New Control Syntax</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="indentation.html"><span>Optional Braces</span></a></span></div><div class="ni n1 expanded"><span class="nh h100 selected de"><a href="#"><span>Safe Initialization</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="type-test.html"><span>TypeTest</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="experimental-defs.html"><span>Experimental Definitions</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="binary-literals.html"><span>Binary Integer Literals</span></a></span></div></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../changed-features/index.html"><span>Other Changed Features</span></a></span><div class="ni n1 "><span class="nh de"><a href="../changed-features/numeric-literals.html"><span>Numeric Literals</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/structural-types.html"><span>Programmatic Structural Types</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/operators.html"><span>Rules for Operators</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/wildcards.html"><span>Wildcard Arguments in Types</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/imports.html"><span>Imports</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/type-inference.html"><span>Changes in Type Inference</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/implicit-resolution.html"><span>Changes in Implicit Resolution</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/implicit-conversions.html"><span>Implicit Conversions</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/overload-resolution.html"><span>Changes in Overload Resolution</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/match-syntax.html"><span>Match Expressions</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/vararg-splices.html"><span>Vararg Splices</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/pattern-bindings.html"><span>Pattern Bindings</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/pattern-matching.html"><span>Option-less pattern matching</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/eta-expansion.html"><span>Automatic Eta Expansion</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/compiler-plugins.html"><span>Changes in Compiler Plugins</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/lazy-vals-init.html"><span>Lazy Vals Initialization</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/main-functions.html"><span>Main Methods</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../changed-features/interpolation-escapes.html"><span>Escapes in interpolations</span></a></span></div></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../dropped-features/index.html"><span>Dropped Features</span></a></span><div class="ni n1 "><span class="nh de"><a href="../dropped-features/delayed-init.html"><span>Dropped: DelayedInit</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/macros.html"><span>Dropped: Scala 2 Macros</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/existential-types.html"><span>Dropped: Existential Types</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/type-projection.html"><span>Dropped: General Type Projection</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/do-while.html"><span>Dropped: Do-While</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/procedure-syntax.html"><span>Dropped: Procedure Syntax</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/package-objects.html"><span>Dropped: Package Objects</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/early-initializers.html"><span>Dropped: Early Initializers</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/class-shadowing.html"><span>Dropped: Class Shadowing</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/limit22.html"><span>Dropped: Limit 22</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/xml.html"><span>Dropped: XML Literals</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/symlits.html"><span>Dropped: Symbol Literals</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/auto-apply.html"><span>Dropped: Auto-Application</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/weak-conformance.html"><span>Dropped: Weak Conformance</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/nonlocal-returns.html"><span>Deprecated: Nonlocal Returns</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/this-qualifier.html"><span>Dropped: private[this] and protected[this]</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../dropped-features/wildcard-init.html"><span>Dropped: Wildcard Initializer</span></a></span></div></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../experimental/index.html"><span>Experimental</span></a></span><div class="ni n1 "><span class="nh de"><a href="../experimental/canthrow.html"><span>CanThrow Capabilities</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../experimental/erased-defs.html"><span>Erased Definitions</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../experimental/named-typeargs.html"><span>Named Type Arguments</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../experimental/numeric-literals.html"><span>Numeric Literals</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../experimental/explicit-nulls.html"><span>Explicit Nulls</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../experimental/main-annotation.html"><span>MainAnnotation</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../experimental/cc.html"><span>Capture Checking</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../experimental/tupled-function.html"><span>Tupled Function</span></a></span></div></div><div class="ni n0 "><span class="nh de"><a href="../syntax.html"><span>Scala 3 Syntax Summary</span></a></span></div><div class="ni n0"><span class="nh de"><button class="ar icon-button "></button><a href="../language-versions/index.html"><span>Language Versions</span></a></span><div class="ni n1 "><span class="nh de"><a href="../language-versions/source-compatibility.html"><span>Source Compatibility</span></a></span></div><div class="ni n1 "><span class="nh de"><a href="../language-versions/binary-compatibility.html"><span>Binary Compatibility</span></a></span></div></div><div class="ni n0 "><span class="nh de"><a href="../soft-modifier.html"><span>Soft Keywords</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="../features-classification.html"><span>A Classification of Proposed Language Features</span></a></span></div></nav></div><div id="footer" class="body-small"><div class="left-container">Generated with</div><div class="right-container"><a href="https://github.com/scala/scala3"><button class="icon-button gh"></button></a><a href="https://discord.com/invite/scala"><button class="icon-button discord"></button></a><a href="https://twitter.com/scala_lang"><button class="icon-button twitter"></button></a><div class="text">Copyright (c) 2002-2025, LAMP/EPFL</div></div><div class="text-mobile">Copyright (c) 2002-2025, LAMP/EPFL</div></div><div id="scaladoc-searchBar"></div><div id="main"><div class="breadcrumbs container"><a href="../index.html">Scala 3 Reference</a>/<a href="index.html">Other New Features</a>/<a href="safe-initialization.html">Safe Initialization</a></div><div id="content" class="body-medium"><div><div id="content-wrapper">
 <div class="site-container">
  <div id="site-header"></div>
  <main>
   <header>
    <a class="text-button with-link body-small" href="https://github.com/scala/scala3/edit/language-reference-stable/docs/_docs/reference/other-new-features/safe-initialization.md">Edit this page on GitHub</a>
    <h1 class="h600">Safe Initialization</h1>
   </header>
   <p class="body-large first-p">Scala 3 implements experimental safe initialization check, which can be enabled by the compiler option <code>-Wsafe-init</code>.</p>
   <p>The design and implementation of the initialization checker is described in the paper <em>Safe object initialization, abstractly</em> [3].</p>
   <section id="a-quick-glance-1">
    <h2 class="h500"><a href="#a-quick-glance-1" class="anchor"></a>A Quick Glance</h2>
    <p>To get a feel of how it works, we first show several examples below.</p>
   </section>
   <section id="parent-child-interaction-1">
    <h3 class="h400"><a href="#parent-child-interaction-1" class="anchor"></a>Parent-Child Interaction</h3>
    <p>Given the following code snippet:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>abstract class AbstractFile:
</span><span line-number="2" class=""><span class="tooltip-container"></span>  def name: String
</span><span line-number="3" class=""><span class="tooltip-container"></span>  val extension: String = name.substring(4)
</span><span line-number="4" class=""><span class="tooltip-container"></span>
</span><span line-number="5" class=""><span class="tooltip-container"></span>class RemoteFile(url: String) extends AbstractFile:
</span><span line-number="6" class=""><span class="tooltip-container"></span>  val localFile: String = s"${url.##}.tmp"  // error: usage of `localFile` before it's initialized
</span><span line-number="7" class=""><span class="tooltip-container"></span>  def name: String = localFile
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>The checker will report:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>-- Warning: tests/init/neg/AbstractFile.scala:7:4 ------------------------------
</span><span line-number="2" class=""><span class="tooltip-container"></span>7 |	val localFile: String = s"${url.##}.tmp"  // error: usage of `localFile` before it's initialized
</span><span line-number="3" class=""><span class="tooltip-container"></span>  |	    ^
</span><span line-number="4" class=""><span class="tooltip-container"></span>  |    Access non-initialized field value localFile. Calling trace:
</span><span line-number="5" class=""><span class="tooltip-container"></span>  |     -&gt; val extension: String = name.substring(4)	[ AbstractFile.scala:3 ]
</span><span line-number="6" class=""><span class="tooltip-container"></span>  |      -&gt; def name: String = localFile            	[ AbstractFile.scala:8 ]
</span></code></pre>
     <div class="buttons"></div>
    </div>
   </section>
   <section id="inner-outer-interaction-1">
    <h3 class="h400"><a href="#inner-outer-interaction-1" class="anchor"></a>Inner-Outer Interaction</h3>
    <p>Given the code below:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>object Trees:
</span><span line-number="2" class=""><span class="tooltip-container"></span>  class ValDef { counter += 1 }
</span><span line-number="3" class=""><span class="tooltip-container"></span>  class EmptyValDef extends ValDef
</span><span line-number="4" class=""><span class="tooltip-container"></span>  val theEmptyValDef = new EmptyValDef
</span><span line-number="5" class=""><span class="tooltip-container"></span>  private var counter = 0  // error
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>The checker will report:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>-- Warning: tests/init/neg/trees.scala:5:14 ------------------------------------
</span><span line-number="2" class=""><span class="tooltip-container"></span>5 |  private var counter = 0  // error
</span><span line-number="3" class=""><span class="tooltip-container"></span>  |              ^
</span><span line-number="4" class=""><span class="tooltip-container"></span>  |             Access non-initialized field variable counter. Calling trace:
</span><span line-number="5" class=""><span class="tooltip-container"></span>  |              -&gt; val theEmptyValDef = new EmptyValDef    [ trees.scala:4 ]
</span><span line-number="6" class=""><span class="tooltip-container"></span>  |               -&gt; class EmptyValDef extends ValDef       [ trees.scala:3 ]
</span><span line-number="7" class=""><span class="tooltip-container"></span>  |                -&gt; class ValDef { counter += 1 }	     [ trees.scala:2 ]
</span></code></pre>
     <div class="buttons"></div>
    </div>
   </section>
   <section id="functions-1">
    <h3 class="h400"><a href="#functions-1" class="anchor"></a>Functions</h3>
    <p>Given the code below:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>abstract class Parent:
</span><span line-number="2" class=""><span class="tooltip-container"></span>  val f: () =&gt; String = () =&gt; this.message
</span><span line-number="3" class=""><span class="tooltip-container"></span>  def message: String
</span><span line-number="4" class=""><span class="tooltip-container"></span>
</span><span line-number="5" class=""><span class="tooltip-container"></span>class Child extends Parent:
</span><span line-number="6" class=""><span class="tooltip-container"></span>  val a = f()
</span><span line-number="7" class=""><span class="tooltip-container"></span>  val b = "hello"           // error
</span><span line-number="8" class=""><span class="tooltip-container"></span>  def message: String = b
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>The checker reports:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>-- Warning: tests/init/neg/features-high-order.scala:7:6 -----------------------
</span><span line-number="2" class=""><span class="tooltip-container"></span>7 |  val b = "hello"           // error
</span><span line-number="3" class=""><span class="tooltip-container"></span>  |      ^
</span><span line-number="4" class=""><span class="tooltip-container"></span>  |Access non-initialized field value b. Calling trace:
</span><span line-number="5" class=""><span class="tooltip-container"></span>  | -&gt; val a = f()                              	[ features-high-order.scala:6 ]
</span><span line-number="6" class=""><span class="tooltip-container"></span>  |   -&gt; val f: () =&gt; String = () =&gt; this.message	[ features-high-order.scala:2 ]
</span><span line-number="7" class=""><span class="tooltip-container"></span>  |    -&gt; def message: String = b	                [ features-high-order.scala:8 ]
</span></code></pre>
     <div class="buttons"></div>
    </div>
   </section>
   <section id="design-goals-1">
    <h2 class="h500"><a href="#design-goals-1" class="anchor"></a>Design Goals</h2>
    <p>We establish the following design goals:</p>
    <ul>
     <li><strong>Sound</strong>: checking always terminates, and is sound for common and reasonable usage (over-approximation)</li>
     <li><strong>Expressive</strong>: support common and reasonable initialization patterns</li>
     <li><strong>Friendly</strong>: simple rules, minimal syntactic overhead, informative error messages</li>
     <li><strong>Modular</strong>: modular checking, no analysis beyond project boundary</li>
     <li><strong>Fast</strong>: instant feedback</li>
     <li><strong>Simple</strong>: no changes to core type system, explainable by a simple theory</li>
    </ul>
    <p>By <em>reasonable usage</em>, we include the following use cases (but not restricted to them):</p>
    <ul>
     <li>Access fields on <code>this</code> and outer <code>this</code> during initialization</li>
     <li>Call methods on <code>this</code> and outer <code>this</code> during initialization</li>
     <li>Instantiate inner class and call methods on such instances during initialization</li>
     <li>Capture fields in functions</li>
    </ul>
   </section>
   <section id="principles-1">
    <h2 class="h500"><a href="#principles-1" class="anchor"></a>Principles</h2>
    <p>To achieve the goals, we uphold the following fundamental principles: <em>stackability</em>, <em>monotonicity</em>, <em>scopability</em> and <em>authority</em>.</p>
    <p>Stackability means that all fields of a class are initialized at the end of the class body. Scala enforces this property in syntax by demanding that all fields are initialized at the end of the primary constructor, except for the language feature below:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>var x: T = _
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>Control effects such as exceptions may break this property, as the following example shows:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>class MyException(val b: B) extends Exception("")
</span><span line-number="2" class=""><span class="tooltip-container"></span>class A:
</span><span line-number="3" class=""><span class="tooltip-container"></span>  val b = try { new B } catch { case myEx: MyException =&gt; myEx.b }
</span><span line-number="4" class=""><span class="tooltip-container"></span>  println(b.a)
</span><span line-number="5" class=""><span class="tooltip-container"></span>
</span><span line-number="6" class=""><span class="tooltip-container"></span>class B:
</span><span line-number="7" class=""><span class="tooltip-container"></span>  throw new MyException(this)
</span><span line-number="8" class=""><span class="tooltip-container"></span>  val a: Int = 1
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>In the code above, the control effect teleport the uninitialized value wrapped in an exception. In the implementation, we avoid the problem by ensuring that the values that are thrown must be transitively initialized.</p>
    <p>Monotonicity means that the initialization status of an object should not go backward: initialized fields continue to be initialized, a field points to an initialized object may not later point to an object under initialization. As an example, the following code will be rejected:</p>
    <div class="snippet mono-small-block" scala-snippet="">
     <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>trait Reporter:
</span><span line-number="2" class=""><span class="tooltip-container"></span>  def report(msg: String): Unit
</span><span line-number="3" class=""><span class="tooltip-container"></span>
</span><span line-number="4" class=""><span class="tooltip-container"></span>class FileReporter(ctx: Context) extends Reporter:
</span><span line-number="5" class=""><span class="tooltip-container"></span>  ctx.typer.reporter = this                // ctx now reaches an uninitialized object
</span><span line-number="6" class=""><span class="tooltip-container"></span>  val file: File = new File("report.txt")
</span><span line-number="7" class=""><span class="tooltip-container"></span>  def report(msg: String) = file.write(msg)
</span></code></pre>
     <div class="buttons"></div>
    </div>
    <p>In the code above, suppose <code>ctx</code> points to a transitively initialized object. Now the assignment at line 3 makes <code>this</code>, which is not fully initialized, reachable from <code>ctx</code>. This makes field usage dangerous, as it may indirectly reach uninitialized fields.</p>
    <p>Monotonicity is based on a well-known technique called <em>heap monotonic typestate</em> to ensure soundness in the presence of aliasing [1]. Roughly speaking, it means initialization state should not go backwards.</p>
    <p>Scopability means that there are no side channels to access to partially constructed objects. Control effects like coroutines, delimited control, resumable exceptions may break the property, as they can transport a value upper in the stack (not in scope) to be reachable from the current scope. Static fields can also serve as a teleport thus breaks this property. In the implementation, we need to enforce that teleported values are transitively initialized.</p>
    <p>The three principles above contribute to <em>local reasoning about initialization</em>, which means:</p>
    <blockquote>
     <p>An initialized environment can only produce initialized values.</p>
    </blockquote>
    <p>For example, if the arguments to an <code>new</code>-expression are transitively initialized, so is the result. If the receiver and arguments in a method call are transitively initialized, so is the result.</p>
    <p>Local reasoning about initialization gives rise to a fast initialization checker, as it avoids whole-program analysis.</p>
    <p>The principle of authority goes hand-in-hand with monotonicity: the principle of monotonicity stipulates that initialization states cannot go backwards, while the principle of authority stipulates that the initialization states may not go forward at arbitrary locations due to aliasing. In Scala, we may only advance initialization states of objects in the class body when a field is defined with a mandatory initializer or at local reasoning points when the object becomes transitively initialized.</p>
   </section>
   <section id="abstract-values-1">
    <h2 class="h500"><a href="#abstract-values-1" class="anchor"></a>Abstract Values</h2>
    <p>There are three fundamental abstractions for initialization states of objects:</p>
    <ul>
     <li><strong>Cold</strong>: A cold object may have uninitialized fields.</li>
     <li><strong>Warm</strong>: A warm object has all its fields initialized but may reach <em>cold</em> objects.</li>
     <li><strong>Hot</strong>: A hot object is transitively initialized, i.e., it only reaches warm objects.</li>
    </ul>
    <p>In the initialization checker, the abstraction <code>Warm</code> is refined to handle inner classes and multiple constructors:</p>
    <ul>
     <li><strong>Warm[C] { outer = V, ctor, args = Vs }</strong>: A warm object of class <code>C</code>, where the immediate outer of <code>C</code> is <code>V</code>, the constructor is <code>ctor</code> and constructor arguments are <code>Vs</code>.</li>
    </ul>
    <p>The initialization checker checks each concrete class separately. The abstraction <code>ThisRef</code> represents the current object under initialization:</p>
    <ul>
     <li><strong>ThisRef[C]</strong>: The current object of class <code>C</code> under initialization.</li>
    </ul>
    <p>The initialization state of the current object is stored in the abstract heap as an abstract object. The abstract heap also serves as a cache for the field values of warm objects. <code>Warm</code> and <code>ThisRef</code> are "addresses" of the abstract objects stored in the abstract heap.</p>
    <p>Two more abstractions are introduced to support functions and conditional expressions:</p>
    <ul>
     <li>
      <p><strong>Fun(e, V, C)</strong>: An abstract function value where <code>e</code> is the code, <code>V</code> is the abstract value for <code>this</code> inside the function body and the function is located inside the class <code>C</code>.</p></li>
     <li>
      <p><strong>Refset(Vs)</strong>: A set of abstract values <code>Vs</code>.</p></li>
    </ul>
    <p>A value <code>v</code> is <em>effectively hot</em> if any of the following is true:</p>
    <ul>
     <li><code>v</code> is <code>Hot</code>.</li>
     <li><code>v</code> is <code>ThisRef</code> and all fields of the underlying object are assigned.</li>
     <li><code>v</code> is <code>Warm[C] { ... }</code> and 
      <ol>
       <li><code>C</code> does not contain inner classes; and</li>
       <li>Calling any method on <code>v</code> encounters no initialization errors and the method return value is <em>effectively hot</em>; and</li>
       <li>Each field of <code>v</code> is <em>effectively hot</em>.</li>
      </ol></li>
     <li><code>v</code> is <code>Fun(e, V, C)</code> and calling the function encounters no errors and the function return value is <em>effectively hot</em>.</li>
     <li>The root object (refered by <code>ThisRef</code>) is <em>effectively hot</em>.</li>
    </ul>
    <p>An effectively hot value can be regarded as transitively initialized thus can be safely leaked via method arguments or as RHS of reassignment. The initialization checker tries to promote non-hot values to effectively hot whenenver possible.</p>
   </section>
   <section id="rules-3">
    <h2 class="h500"><a href="#rules-3" class="anchor"></a>Rules</h2>
    <p>With the established principles and design goals, the following rules are imposed:</p>
    <ol>
     <li>
      <p>The field access <code>e.f</code> or method call <code>e.m()</code> is illegal if <code>e</code> is <em>cold</em>.</p>
      <p>A cold value should not be used.</p></li>
     <li>
      <p>The field access <code>e.f</code> is invalid if <code>e</code> has the value <code>ThisRef</code> and <code>f</code> is not initialized.</p></li>
     <li>
      <p>In an assignment <code>o.x = e</code>, the expression <code>e</code> must be <em>effectively hot</em>.</p>
      <p>This is how monotonicity is enforced in the system. Note that in an initialization <code>val f: T = e</code>, the expression <code>e</code> may point to a non-hot value.</p></li>
     <li>
      <p>Arguments to method calls must be <em>effectively hot</em>.</p>
      <p>Escape of <code>this</code> in the constructor is commonly regarded as an anti-pattern.</p>
      <p>However, passing non-hot values as argument to another constructor is allowed, to support creation of cyclic data structures. The checker will ensure that the escaped non-initialized object is not used, i.e. calling methods or accessing fields on the escaped object is not allowed.</p>
      <p>An exception is for calling synthetic <code>apply</code>s of case classes. For example, the method call <code>Some.apply(e)</code> will be interpreted as <code>new Some(e)</code>, thus is valid even if <code>e</code> is not hot.</p>
      <p>Another exception to this rule is parametric method calls. For example, in <code>List.apply(e)</code>, the argument <code>e</code> may be non-hot. If that is the case, the result value of the parametric method call is taken as <em>cold</em>.</p></li>
     <li>
      <p>Method calls on hot values with effectively hot arguments produce hot results.</p>
      <p>This rule is assured by local reasoning about initialization.</p></li>
     <li>
      <p>Method calls on <code>ThisRef</code> and warm values will be resolved statically and the corresponding method bodies are checked.</p></li>
     <li>
      <p>In a new expression <code>new p.C(args)</code>, if the values of <code>p</code> and <code>args</code> are effectively hot, then the result value is also hot.</p>
      <p>This is assured by local reasoning about initialization.</p></li>
     <li>
      <p>In a new expression <code>new p.C(args)</code>, if any value of <code>p</code> and <code>args</code> is not effectively hot, then the result value takes the form <code>Warm[C] { outer = Vp, args = Vargs }</code>. The initialization code for the class <code>C</code> is checked again to make sure the non-hot values are used properly.</p>
      <p>In the above, <code>Vp</code> is the widened value of <code>p</code> --- the widening happens if <code>p</code> is a warm value <code>Warm[D] { outer = V, args }</code> and we widen it to <code>Warm[D] { outer = Cold, args }</code>.</p>
      <p>The variable <code>Vargs</code> represents values of <code>args</code> with non-hot values widened to <code>Cold</code>.</p>
      <p>The motivation for the widening is to finitize the abstract domain and ensure termination of the initialization check.</p></li>
     <li>
      <p>The scrutinee in a pattern match and the values in return and throw statements must be <em>effectively hot</em>.</p></li>
    </ol>
   </section>
   <section id="modularity-1">
    <h2 class="h500"><a href="#modularity-1" class="anchor"></a>Modularity</h2>
    <p>The analysis takes the primary constructor of concrete classes as entry points. It follows the constructors of super classes, which might be defined in another project. The analysis takes advantage of TASTy for analyzing super classes defined in another project.</p>
    <p>The crossing of project boundary raises a concern about modularity. It is well-known in object-oriented programming that superclass and subclass are tightly coupled. For example, adding a method in the superclass requires recompiling the child class for checking safe overriding.</p>
    <p>Initialization is no exception in this respect. The initialization of an object essentially involves close interaction between subclass and superclass. If the superclass is defined in another project, the crossing of project boundary cannot be avoided for soundness of the analysis.</p>
    <p>Meanwhile, inheritance across project boundary has been under scrutiny and the introduction of <a href="open-classes.html">open classes</a> mitigate the concern here. For example, the initialization check could enforce that the constructors of open classes may not contain method calls on <code>this</code> or introduce annotations as a contract.</p>
    <p>The feedback from the community on the topic is welcome.</p>
   </section>
   <section id="back-doors-1">
    <h2 class="h500"><a href="#back-doors-1" class="anchor"></a>Back Doors</h2>
    <p>Occasionally you may want to suppress warnings reported by the checker. You can either write <code>e: @unchecked</code> to tell the checker to skip checking for the expression <code>e</code>, or you may use the old trick: mark some fields as lazy.</p>
   </section>
   <section id="caveats-2">
    <h2 class="h500"><a href="#caveats-2" class="anchor"></a>Caveats</h2>
    <ul>
     <li>The system cannot provide safety guarantee when extending Java or Scala 2 classes.</li>
     <li>Safe initialization of global objects is only partially checked.</li>
    </ul>
   </section>
   <section id="references-1">
    <h2 class="h500"><a href="#references-1" class="anchor"></a>References</h2>
    <ol>
     <li>Fähndrich, M. and Leino, K.R.M., 2003, July. <a href="https://www.microsoft.com/en-us/research/publication/heap-monotonic-typestate/"><em>Heap monotonic typestates</em></a>. In International Workshop on Aliasing, Confinement and Ownership in object-oriented programming (IWACO).</li>
     <li>Fengyun Liu, Ondřej Lhoták, Aggelos Biboudis, Paolo G. Giarrusso, and Martin Odersky. <a href="https://dl.acm.org/doi/10.1145/3428243"><em>A type-and-effect system for object initialization</em></a>. OOPSLA, 2020.</li>
     <li>Fengyun Liu, Ondřej Lhoták, Enze Xing, Nguyen Cao Pham. <a href="https://dl.acm.org/doi/10.1145/3486610.3486895"><em>Safe object initialization, abstractly</em></a>. Scala 2021.</li>
    </ol>
   </section>
  </main>
  <div class="divider"></div>
  <nav class="arrow-navigation" aria-label="Page navigation">
   <div>
    <span class="body-small">Previous</span> <a rel="prev" href="indentation.html" aria-keyshortcuts="Left" class="body-medium"> <span class="body-medium">Optional Braces</span> </a>
   </div>
   <div>
    <span class="body-small">Next</span> <a rel="next" href="type-test.html" aria-keyshortcuts="Right" class="body-medium"> <span class="body-medium">TypeTest</span> </a>
   </div>
  </nav>
 </div>
</div></div><div id="toc" class="body-small"><div id="toc-container"><span class="toc-title h200">In this article</span><nav class="toc-nav"><ul class="toc-list"><li><a href="#a-quick-glance-1">A Quick Glance</a><ul><li><a href="#parent-child-interaction-1">Parent-Child Interaction</a></li><li><a href="#inner-outer-interaction-1">Inner-Outer Interaction</a></li><li><a href="#functions-1">Functions</a></li></ul></li><li><a href="#design-goals-1">Design Goals</a></li><li><a href="#principles-1">Principles</a></li><li><a href="#abstract-values-1">Abstract Values</a></li><li><a href="#rules-3">Rules</a></li><li><a href="#modularity-1">Modularity</a></li><li><a href="#back-doors-1">Back Doors</a></li><li><a href="#caveats-2">Caveats</a></li><li><a href="#references-1">References</a></li></ul></nav></div></div></div><div id="footer" class="body-small mobile-footer"><div class="left-container">Generated with</div><div class="right-container"><a href="https://github.com/scala/scala3"><button class="icon-button gh"></button></a><a href="https://discord.com/invite/scala"><button class="icon-button discord"></button></a><a href="https://twitter.com/scala_lang"><button class="icon-button twitter"></button></a><div class="text">Copyright (c) 2002-2025, LAMP/EPFL</div></div><div class="text-mobile">Copyright (c) 2002-2025, LAMP/EPFL</div></div></div></div></body></html>