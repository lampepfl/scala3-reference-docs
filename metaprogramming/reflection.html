<html><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><title>Reflection</title><link rel="shortcut icon" type="image/x-icon" href="../favicon.ico"></link><script type="text/javascript" src="../scripts/theme.js"></script><link rel="stylesheet" href="../css/bootstrap.min.css"></link><link rel="stylesheet" href="../css/dottydoc.css"></link><link rel="stylesheet" href="../css/color-brewer.css"></link><script type="text/javascript" src="../js/jquery.min.js" defer="true"></script><script type="text/javascript" src="../js/bootstrap.min.js" defer="true"></script><link rel="stylesheet" href="../css/content-contributors.css"></link><script type="text/javascript" src="../js/contributors.js" defer="true"></script><script type="text/javascript" src="../scripts/searchData.js" defer="true"></script><script type="text/javascript" src="../scripts/scastieConfiguration.js" defer="true"></script><link rel="stylesheet" href="../styles/nord-light.css"></link><link rel="stylesheet" href="../styles/scalastyle.css"></link><link rel="stylesheet" href="../styles/colors.css"></link><link rel="stylesheet" href="../styles/dotty-icons.css"></link><link rel="stylesheet" href="../styles/diagram.css"></link><link rel="stylesheet" href="../styles/filter-bar.css"></link><link rel="stylesheet" href="../styles/code-snippets.css"></link><link rel="stylesheet" href="../styles/searchbar.css"></link><link rel="stylesheet" href="../styles/social-links.css"></link><link rel="stylesheet" href="../styles/ux.css"></link><link rel="stylesheet" href="../styles/versions-dropdown.css"></link><link rel="stylesheet" href="../styles/fontawesome.css"></link><script type="text/javascript" src="../hljs/highlight.min.js" defer="true"></script><script type="text/javascript" src="../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../scripts/scaladoc-scalajs.js" defer="true"></script><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><script type="text/javascript" src="https://scastie.scala-lang.org/embedded.js" defer="true"></script><script type="text/javascript" src="../scripts/data.js" defer="true"></script><script>var pathToRoot = "../";</script><script>var githubContributorsUrl = "https://api.github.com/repos/lampepfl/dotty";</script><script>var githubContributorsFilename = "docs/_docs/reference/metaprogramming/reflection.md";</script></head><body><div id="container"><div id="leftColumn"><div id="logo"><span><img src="../project-logo/logo.svg"></img></span><span><div class="projectName">Scala 3 Reference</div></span><div id="version"><div class="versions-dropdown"><div onclick="dropdownHandler()" id="dropdown-button" class="dropdownbtn dropdownbtnactive"><div class="projectVersion">3.1.2</div><div id="dropdown-content" class="dropdown-content"><input type="text" placeholder="Search..." id="dropdown-input" onkeyup="filterFunction()"></input></div></div></div></div><div class="socials"><a href="https://github.com/lampepfl/dotty"><span class="social-icon" data-icon-path="github-icon-white.png"></span></a><a href="https://discord.com/invite/scala"><span class="social-icon" data-icon-path="discord-icon-white.png"></span></a><a href="https://twitter.com/scala_lang"><span class="social-icon" data-icon-path="twitter-icon-white.png"></span></a></div></div><div id="paneSearch"></div><nav id="sideMenu2"><div class="ni expanded"><span class="nh expanded"><span class="ar"></span><a href="../index.html"><span>Scala 3 Reference</span></a></span><div class="ni"><span class="nh "><span class="ar"></span><a href="../new-types/index.html"><span>New Types</span></a></span><div class="ni "><span class="nh "><a href="../new-types/intersection-types.html"><span>Intersection Types</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/intersection-types-spec.html"><span>Intersection Types - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/union-types.html"><span>Union Types</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/union-types-spec.html"><span>Union Types - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/type-lambdas.html"><span>Type Lambdas</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/type-lambdas-spec.html"><span>Type Lambdas - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/match-types.html"><span>Match Types</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/dependent-function-types.html"><span>Dependent Function Types</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/dependent-function-types-spec.html"><span>Dependent Function Types - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../new-types/polymorphic-function-types.html"><span>Polymorphic Function Types</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../enums/index.html"><span>Enums</span></a></span><div class="ni "><span class="nh "><a href="../enums/enums.html"><span>Enumerations</span></a></span></div><div class="ni "><span class="nh "><a href="../enums/adts.html"><span>Algebraic Data Types</span></a></span></div><div class="ni "><span class="nh "><a href="../enums/desugarEnums.html"><span>Translation of Enums and ADTs</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../contextual/index.html"><span>Contextual Abstractions</span></a></span><div class="ni "><span class="nh "><a href="../contextual/givens.html"><span>Given Instances</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/using-clauses.html"><span>Using Clauses</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/context-bounds.html"><span>Context Bounds</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/given-imports.html"><span>Importing Givens</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/extension-methods.html"><span>Extension Methods</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/right-associative-extension-methods.html"><span>Right-Associative Extension Methods: Details</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/type-classes.html"><span>Implementing Type classes</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/derivation.html"><span>Type Class Derivation</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/derivation-macro.html"><span>How to write a type class `derived` method using macros</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/multiversal-equality.html"><span>Multiversal Equality</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/context-functions.html"><span>Context Functions</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/context-functions-spec.html"><span>Context Functions - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/conversions.html"><span>Implicit Conversions</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/by-name-context-parameters.html"><span>By-Name Context Parameters</span></a></span></div><div class="ni "><span class="nh "><a href="../contextual/relationship-implicits.html"><span>Relationship with Scala 2 Implicits</span></a></span></div></div><div class="ni expanded"><span class="nh expanded"><span class="ar"></span><a href="index.html"><span>Metaprogramming</span></a></span><div class="ni "><span class="nh "><a href="inline.html"><span>Inline</span></a></span></div><div class="ni "><span class="nh "><a href="compiletime-ops.html"><span>Compile-time operations</span></a></span></div><div class="ni "><span class="nh "><a href="macros.html"><span>Macros</span></a></span></div><div class="ni "><span class="nh "><a href="macros-spec.html"><span>Macros Spec</span></a></span></div><div class="ni "><span class="nh "><a href="staging.html"><span>Runtime Multi-Stage Programming</span></a></span></div><div class="ni expanded"><span class="nh selected"><a href="reflection.html"><span>Reflection</span></a></span></div><div class="ni "><span class="nh "><a href="tasty-inspect.html"><span>TASTy Inspection</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../other-new-features/index.html"><span>Other New Features</span></a></span><div class="ni "><span class="nh "><a href="../other-new-features/trait-parameters.html"><span>Trait Parameters</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/transparent-traits.html"><span>Transparent Traits</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/creator-applications.html"><span>Universal Apply Methods</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/export.html"><span>Export Clauses</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/opaques.html"><span>Opaque Type Aliases</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/opaques-details.html"><span>Opaque Type Aliases: More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/open-classes.html"><span>Open Classes</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/parameter-untupling.html"><span>Parameter Untupling</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/parameter-untupling-spec.html"><span>Parameter Untupling - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/kind-polymorphism.html"><span>Kind Polymorphism</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/matchable.html"><span>The Matchable Trait</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/threadUnsafe-annotation.html"><span>The @threadUnsafe annotation</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/targetName.html"><span>The @targetName annotation</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/control-syntax.html"><span>New Control Syntax</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/indentation.html"><span>Optional Braces</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/safe-initialization.html"><span>Safe Initialization</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/type-test.html"><span>TypeTest</span></a></span></div><div class="ni "><span class="nh "><a href="../other-new-features/experimental-defs.html"><span>Experimental Definitions</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../changed-features/index.html"><span>Other Changed Features</span></a></span><div class="ni "><span class="nh "><a href="../changed-features/numeric-literals.html"><span>Numeric Literals</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/structural-types.html"><span>Programmatic Structural Types</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/structural-types-spec.html"><span>Programmatic Structural Types - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/operators.html"><span>Rules for Operators</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/wildcards.html"><span>Wildcard Arguments in Types</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/imports.html"><span>Imports</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/type-checking.html"><span>Changes in Type Checking</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/type-inference.html"><span>Changes in Type Inference</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/implicit-resolution.html"><span>Changes in Implicit Resolution</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/implicit-conversions.html"><span>Implicit Conversions</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/implicit-conversions-spec.html"><span>Implicit Conversions - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/overload-resolution.html"><span>Changes in Overload Resolution</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/match-syntax.html"><span>Match Expressions</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/vararg-splices.html"><span>Vararg Splices</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/pattern-bindings.html"><span>Pattern Bindings</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/pattern-matching.html"><span>Option-less pattern matching</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/eta-expansion.html"><span>Automatic Eta Expansion</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/eta-expansion-spec.html"><span>Automatic Eta Expansion - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/compiler-plugins.html"><span>Changes in Compiler Plugins</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/lazy-vals-init.html"><span>Lazy Vals Initialization</span></a></span></div><div class="ni "><span class="nh "><a href="../changed-features/main-functions.html"><span>Main Methods</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../dropped-features/index.html"><span>Dropped Features</span></a></span><div class="ni "><span class="nh "><a href="../dropped-features/delayed-init.html"><span>Dropped: DelayedInit</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/macros.html"><span>Dropped: Scala 2 Macros</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/existential-types.html"><span>Dropped: Existential Types</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/type-projection.html"><span>Dropped: General Type Projection</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/do-while.html"><span>Dropped: Do-While</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/procedure-syntax.html"><span>Dropped: Procedure Syntax</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/package-objects.html"><span>Dropped: Package Objects</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/early-initializers.html"><span>Dropped: Early Initializers</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/class-shadowing.html"><span>Dropped: Class Shadowing</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/class-shadowing-spec.html"><span>Dropped: Class Shadowing - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/limit22.html"><span>Dropped: Limit 22</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/xml.html"><span>Dropped: XML Literals</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/symlits.html"><span>Dropped: Symbol Literals</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/auto-apply.html"><span>Dropped: Auto-Application</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/weak-conformance.html"><span>Dropped: Weak Conformance</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/weak-conformance-spec.html"><span>Dropped: Weak Conformance - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/nonlocal-returns.html"><span>Deprecated: Nonlocal Returns</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/this-qualifier.html"><span>Dropped: private[this] and protected[this]</span></a></span></div><div class="ni "><span class="nh "><a href="../dropped-features/wildcard-init.html"><span>Dropped: Wildcard Initializer</span></a></span></div></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../experimental/index.html"><span>Experimental</span></a></span><div class="ni "><span class="nh "><a href="../experimental/canthrow.html"><span>CanThrow Capabilities</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/erased-defs.html"><span>Erased Definitions</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/erased-defs-spec.html"><span>Erased Definitions - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/named-typeargs.html"><span>Named Type Arguments</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/named-typeargs-spec.html"><span>Named Type Arguments - More Details</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/numeric-literals.html"><span>Numeric Literals</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/explicit-nulls.html"><span>Explicit Nulls</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/main-annotation.html"><span>MainAnnotation</span></a></span></div><div class="ni "><span class="nh "><a href="../experimental/cc.html"><span>Capture Checking</span></a></span></div></div><div class="ni "><span class="nh "><a href="../syntax.html"><span>Scala 3 Syntax Summary</span></a></span></div><div class="ni"><span class="nh "><span class="ar"></span><a href="../language-versions/index.html"><span>Language Versions</span></a></span><div class="ni "><span class="nh "><a href="../language-versions/source-compatibility.html"><span>Source Compatibility</span></a></span></div><div class="ni "><span class="nh "><a href="../language-versions/binary-compatibility.html"><span>Binary Compatibility</span></a></span></div></div><div class="ni "><span class="nh "><a href="../soft-modifier.html"><span>Soft Keywords</span></a></span></div><div class="ni "><span class="nh "><a href="../features-classification.html"><span>A Classification of Proposed Language Features</span></a></span></div></div></nav></div><div id="main"><div id="leftToggler"><span class="icon-toggler"></span></div><div id="scaladoc-searchBar"></div><main id="main-content"><div class="breadcrumbs container"><a href="../index.html">Scala 3 Reference</a>/<a href="index.html">Metaprogramming</a>/<a href="reflection.html">Reflection</a></div><div id="content"><html>
 <head>
  <link rel="dns-prefetch" href="//fonts.googleapis.com"> 
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"> 
 </head>
 <body>
  <div id="content-wrapper"> 
   <div class="container"> 
    <div id="site-header"> 
     <div class="wrap"> 
      <nav class="navigation" role="menu"> 
       <ul class="navigation-menu"> 
        <li class="navigation-menu-item"> <a href="https://docs.scala-lang.org/" class="active">Learn</a> </li> 
        <li class="navigation-menu-item"> <a href="https://www.scala-lang.org/download/">Install</a> </li> 
        <li class="navigation-menu-item"> <a href="https://scastie.scala-lang.org">Playground</a> </li> 
        <li class="navigation-menu-item"> <a href="https://index.scala-lang.org">Find A Library</a> </li> 
        <li class="navigation-menu-item"> <a href="https://www.scala-lang.org/community/">Community</a> </li> 
        <li class="navigation-menu-item"> <a href="https://www.scala-lang.org/blog/">Blog</a> </li> 
       </ul> 
      </nav> 
     </div> 
    </div> 
    <main> 
     <header> 
      <h1>Reflection</h1> 
      <div class="byline"> <a href="https://github.com/lampepfl/dotty/edit/68765c21c758b94845eaec4469a574e541668a31/docs/_docs/reference/metaprogramming/reflection.md"> <i class="far fa-edit"></i> Edit this page on GitHub </a> 
      </div> 
     </header> 
     <p>Reflection enables inspection and construction of Typed Abstract Syntax Trees (Typed-AST). It may be used on quoted expressions (<code>quoted.Expr</code>) and quoted types (<code>quoted.Type</code>) from <a href="macros.html">Macros</a> or on full TASTy files.</p> 
     <p>If you are writing macros, please first read <a href="macros.html">Macros</a>. You may find all you need without using quote reflection.</p> 
     <section id="api-from-quotes-and-splices-to-tasty-reflect-trees-and-back"> 
      <h2><a href="#api-from-quotes-and-splices-to-tasty-reflect-trees-and-back" class="anchor"></a>API: From quotes and splices to TASTy reflect trees and back</h2> 
      <p>With <code>quoted.Expr</code> and <code>quoted.Type</code> we can compute code but also analyze code by inspecting the ASTs. <a href="macros.html">Macros</a> provide the guarantee that the generation of code will be type-correct. Using quote reflection will break these guarantees and may fail at macro expansion time, hence additional explicit checks must be done.</p> 
      <p>To provide reflection capabilities in macros we need to add an implicit parameter of type <code>scala.quoted.Quotes</code> and import <code>quotes.reflect.*</code> from it in the scope where it is used.</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>import scala.quoted.*
</span><span id="1" class=""><span class="tooltip-container"></span>
</span><span id="2" class=""><span class="tooltip-container"></span>inline def natConst(inline x: Int): Int = ${natConstImpl('{x})}
</span><span id="3" class=""><span class="tooltip-container"></span>
</span><span id="4" class=""><span class="tooltip-container"></span>def natConstImpl(x: Expr[Int])(using Quotes): Expr[Int] =
</span><span id="5" class=""><span class="tooltip-container"></span>  import quotes.reflect.*
</span><span id="6" class=""><span class="tooltip-container"></span>  ...
</span></code></pre>
      </div>
     </section>
     <section id="extractors"> 
      <h3><a href="#extractors" class="anchor"></a>Extractors</h3> 
      <p><code>import quotes.reflect.*</code> will provide all extractors and methods on <code>quotes.reflect.Tree</code>s. For example the <code>Literal(_)</code> extractor used below.</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>def natConstImpl(x: Expr[Int])(using Quotes): Expr[Int] =
</span><span id="1" class=""><span class="tooltip-container"></span>  import quotes.reflect.*
</span><span id="2" class=""><span class="tooltip-container"></span>  val tree: Term = x.asTerm
</span><span id="3" class=""><span class="tooltip-container"></span>  tree match
</span><span id="4" class=""><span class="tooltip-container"></span>    case Inlined(_, _, Literal(IntConstant(n))) =&gt;
</span><span id="5" class=""><span class="tooltip-container"></span>      if n &lt;= 0 then
</span><span id="6" class=""><span class="tooltip-container"></span>        report.error("Parameter must be natural number")
</span><span id="7" class=""><span class="tooltip-container"></span>        '{0}
</span><span id="8" class=""><span class="tooltip-container"></span>      else
</span><span id="9" class=""><span class="tooltip-container"></span>        tree.asExprOf[Int]
</span><span id="10" class=""><span class="tooltip-container"></span>    case _ =&gt;
</span><span id="11" class=""><span class="tooltip-container"></span>      report.error("Parameter must be a known constant")
</span><span id="12" class=""><span class="tooltip-container"></span>      '{0}
</span></code></pre>
      </div> 
      <p>We can easily know which extractors are needed using <code>Printer.TreeStructure.show</code>, which returns the string representation the structure of the tree. Other printers can also be found in the <code>Printer</code> module.</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>tree.show(using Printer.TreeStructure)
</span><span id="1" class=""><span class="tooltip-container"></span>// or
</span><span id="2" class=""><span class="tooltip-container"></span>Printer.TreeStructure.show(tree)
</span></code></pre>
      </div> 
      <p>The methods <code>quotes.reflect.Term.{asExpr, asExprOf}</code> provide a way to go back to a <code>quoted.Expr</code>. Note that <code>asExpr</code> returns a <code>Expr[Any]</code>. On the other hand <code>asExprOf[T]</code> returns a <code>Expr[T]</code>, if the type does not conform to it an exception will be thrown at runtime.</p> 
     </section>
     <section id="positions"> 
      <h3><a href="#positions" class="anchor"></a>Positions</h3> 
      <p>The <code>Position</code> in the context provides an <code>ofMacroExpansion</code> value. It corresponds to the expansion site for macros. The macro authors can obtain various information about that expansion site. The example below shows how we can obtain position information such as the start line, the end line or even the source code at the expansion point.</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>def macroImpl()(quotes: Quotes): Expr[Unit] =
</span><span id="1" class=""><span class="tooltip-container"></span>  import quotes.reflect.*
</span><span id="2" class=""><span class="tooltip-container"></span>  val pos = Position.ofMacroExpansion
</span><span id="3" class=""><span class="tooltip-container"></span>
</span><span id="4" class=""><span class="tooltip-container"></span>  val path = pos.sourceFile.jpath.toString
</span><span id="5" class=""><span class="tooltip-container"></span>  val start = pos.start
</span><span id="6" class=""><span class="tooltip-container"></span>  val end = pos.end
</span><span id="7" class=""><span class="tooltip-container"></span>  val startLine = pos.startLine
</span><span id="8" class=""><span class="tooltip-container"></span>  val endLine = pos.endLine
</span><span id="9" class=""><span class="tooltip-container"></span>  val startColumn = pos.startColumn
</span><span id="10" class=""><span class="tooltip-container"></span>  val endColumn = pos.endColumn
</span><span id="11" class=""><span class="tooltip-container"></span>  val sourceCode = pos.sourceCode
</span><span id="12" class=""><span class="tooltip-container"></span>  ...
</span></code></pre>
      </div>
     </section>
     <section id="tree-utilities"> 
      <h3><a href="#tree-utilities" class="anchor"></a>Tree Utilities</h3> 
      <p><code>quotes.reflect</code> contains three facilities for tree traversal and transformation.</p> 
      <p><code>TreeAccumulator</code> ties the knot of a traversal. By calling <code>foldOver(x, tree)(owner)</code> we can dive into the <code>tree</code> node and start accumulating values of type <code>X</code> (e.g., of type <code>List[Symbol]</code> if we want to collect symbols). The code below, for example, collects the <code>val</code> definitions in the tree.</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>def collectPatternVariables(tree: Tree)(using ctx: Context): List[Symbol] =
</span><span id="1" class=""><span class="tooltip-container"></span>  val acc = new TreeAccumulator[List[Symbol]]:
</span><span id="2" class=""><span class="tooltip-container"></span>    def foldTree(syms: List[Symbol], tree: Tree)(owner: Symbol): List[Symbol] = tree match
</span><span id="3" class=""><span class="tooltip-container"></span>      case ValDef(_, _, rhs) =&gt;
</span><span id="4" class=""><span class="tooltip-container"></span>        val newSyms = tree.symbol :: syms
</span><span id="5" class=""><span class="tooltip-container"></span>        foldTree(newSyms, body)(tree.symbol)
</span><span id="6" class=""><span class="tooltip-container"></span>      case _ =&gt;
</span><span id="7" class=""><span class="tooltip-container"></span>        foldOverTree(syms, tree)(owner)
</span><span id="8" class=""><span class="tooltip-container"></span>  acc(Nil, tree)
</span></code></pre>
      </div> 
      <p>A <code>TreeTraverser</code> extends a <code>TreeAccumulator</code> and performs the same traversal but without returning any value. Finally, a <code>TreeMap</code> performs a transformation.</p> 
     </section>
     <section id="valdeflet"> 
      <h4><a href="#valdeflet" class="anchor"></a>ValDef.let</h4> 
      <p><code>quotes.reflect.ValDef</code> also offers a method <code>let</code> that allows us to bind the <code>rhs</code> (right-hand side) to a <code>val</code> and use it in <code>body</code>. Additionally, <code>lets</code> binds the given <code>terms</code> to names and allows to use them in the <code>body</code>. Their type definitions are shown below:</p> 
      <div class="snippet" scala-snippet="">
       <div class="buttons"></div>
       <pre><code class="language-scala"><span id="0" class=""><span class="tooltip-container"></span>def let(rhs: Term)(body: Ident =&gt; Term): Term = ...
</span><span id="1" class=""><span class="tooltip-container"></span>
</span><span id="2" class=""><span class="tooltip-container"></span>def lets(terms: List[Term])(body: List[Term] =&gt; Term): Term = ...
</span></code></pre>
      </div>
     </section> 
    </main> 
    <nav class="arrows-wrapper" aria-label="Page navigation"> <a rel="prev" href="staging.html" class="arrows previous" aria-keyshortcuts="Left"> <span>Runtime Multi-Stage Programming</span> <i class="fa fa-angle-left"></i> </a> <a rel="next" href="tasty-inspect.html" class="arrows next" aria-keyshortcuts="Right"> <span>TASTy Inspection</span> <i class="fa fa-angle-right"></i> </a> 
    </nav> 
    <div class="content-contributors hidden"> <span><b>Contributors to this page</b></span> 
     <div id="documentation-contributors" class="contributors-container"></div> 
    </div> 
   </div> 
  </div>
 </body>
</html></div></main><footer><div id="generated-by"><span class="footer-text">Generated by</span><a href="https://github.com/lampepfl/dotty/tree/main/scaladoc"><img src="../images/scaladoc_logo.svg" alt="scaladoc" class="scaladoc_logo"></img><img src="../images/scaladoc_logo_dark.svg" alt="scaladoc" class="scaladoc_logo_dark"></img></a></div><span id="footer-text">Copyright (c) 2002-2022, LAMP/EPFL</span><div class="socials"><span class="footer-text">Social links</span><a href="https://github.com/lampepfl/dotty"><span class="social-icon" data-icon-path="github-icon-black.png"></span></a><a href="https://discord.com/invite/scala"><span class="social-icon" data-icon-path="discord-icon-black.png"></span></a><a href="https://twitter.com/scala_lang"><span class="social-icon" data-icon-path="twitter-icon-black.png"></span></a></div><div class="mode"><span class="footer-text">Mode</span><label id="theme-toggle" class="switch"><input type="checkbox"></input><span class="slider"></span></label></div><span class="go-to-top-icon"><a href="#container"><span class="icon-vertical_align_top"></span><span class="footer-text">Back to top</span></a></span></footer></div><div id="toc"><span class="toc-title">In this article</span><nav class="toc-nav"><ul class="toc-list"><li><ul><li><a href="#api-from-quotes-and-splices-to-tasty-reflect-trees-and-back">API: From quotes and splices to TASTy reflect trees and back</a><ul><li><a href="#extractors">Extractors</a></li><li><a href="#positions">Positions</a></li><li><a href="#tree-utilities">Tree Utilities</a><ul><li><a href="#valdeflet">ValDef.let</a></li></ul></li></ul></li></ul></li></ul></nav></div></div></body></html>